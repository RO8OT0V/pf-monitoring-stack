#!/bin/bash

echo "๐ ะะฐะฟััะบ ะผะพะฝะธัะพัะธะฝะณ ััะตะบะฐ..."
echo "==============================================="

# ะัะพะฒะตััะตะผ, ััะพ ะผั ะฒ ะฟัะฐะฒะธะปัะฝะพะน ะดะธัะตะบัะพัะธะธ
if [ ! -f "docker-compose.yml" ]; then
    echo "โ ะคะฐะนะป docker-compose.yml ะฝะต ะฝะฐะนะดะตะฝ!"
    echo "ะฃะฑะตะดะธัะตัั, ััะพ ะฒั ะฝะฐัะพะดะธัะตัั ะฒ ะดะธัะตะบัะพัะธะธ ะฟัะพะตะบัะฐ"
    exit 1
fi

# ะัะพะฒะตััะตะผ ะดะพัััะฟะฝะพััั ะฟะพััะพะฒ
echo "๐ ะัะพะฒะตััะตะผ ะดะพัััะฟะฝะพััั ะฟะพััะพะฒ..."
for port in 9100 9101 9102; do
    if netstat -tuln | grep -q ":$port "; then
        echo "โ๏ธ  ะะพัั $port ัะถะต ะธัะฟะพะปัะทัะตััั!"
        echo "ะะฐะฒะตััะธัะต ะฟัะพัะตัั ะธะปะธ ะธะทะผะตะฝะธัะต ะฟะพัั ะฒ docker-compose.yml"
        exit 1
    fi
done

echo "โ ะัะต ะฟะพััั ะดะพัััะฟะฝั"

# ะะฐะฟััะบะฐะตะผ ััะตะบ
echo "๐ณ ะะฐะฟััะบะฐะตะผ Docker Compose..."
docker-compose up -d

# ะัะพะฒะตััะตะผ ััะฐััั
echo ""
echo "๐ ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ:"
docker-compose ps

# ะะพะปััะฐะตะผ IP ะฐะดัะตั
SERVER_IP=$(ip route get 8.8.8.8 | grep -oP 'src \K\S+' 2>/dev/null || echo "localhost")

echo ""
echo "๐ ะะพะฝะธัะพัะธะฝะณ ััะตะบ ะทะฐะฟััะตะฝ!"
echo "==============================================="
echo "๐ Prometheus:    http://$SERVER_IP:9100"
echo "๐ Grafana:       http://$SERVER_IP:9101"
echo "๐ฅ๏ธ  Node Exporter: http://$SERVER_IP:9102"
echo ""
echo "๐ค Grafana ะปะพะณะธะฝ: admin"
echo "๐ Grafana ะฟะฐัะพะปั: DevOps2024!"
echo "==============================================="
